/*!
=========================================================
* Soft UI Dashboard Tailwind - v1.0.5
=========================================================
* Product Page: https://www.creative-tim.com/product/soft-ui-dashboard-tailwind
* Copyright 2023 Creative Tim
* Licensed under MIT
* Coded by www.creative-tim.com
=========================================================
*/

// --------- Helpers ---------
function loadJS(FILE_URL, async = true) {
  let dynamicScript = document.createElement("script");
  dynamicScript.setAttribute("src", FILE_URL);
  dynamicScript.setAttribute("type", "text/javascript");
  dynamicScript.setAttribute("async", async);
  document.head.appendChild(dynamicScript);
}

function loadStylesheet(FILE_URL) {
  let dynamicStylesheet = document.createElement("link");
  dynamicStylesheet.setAttribute("href", FILE_URL);
  dynamicStylesheet.setAttribute("type", "text/css");
  dynamicStylesheet.setAttribute("rel", "stylesheet");
  document.head.appendChild(dynamicStylesheet);
}

// --------- Dynamic assets loader ---------
var page = window.location.pathname.split("/").pop().split(".")[0];
var aux = window.location.pathname.split("/");
var to_build = aux.includes("pages") ? "../" : "./";
if (!aux.includes("pages")) {
  page = "dashboard";
}

loadStylesheet(to_build + "assets/css/perfect-scrollbar.css");
loadJS(to_build + "assets/js/perfect-scrollbar.js");

if (document.querySelector("nav [navbar-trigger]")) {
  loadJS(to_build + "assets/js/navbar-collapse.js");
}
if (document.querySelector("[data-target='tooltip']")) {
  loadJS(to_build + "assets/js/tooltips.js");
  loadStylesheet(to_build + "assets/css/tooltips.css");
}
if (document.querySelector("[nav-pills]")) {
  loadJS(to_build + "assets/js/nav-pills.js");
}
if (document.querySelector("[dropdown-trigger]")) {
  loadJS(to_build + "assets/js/dropdown.js");
}
if (document.querySelector("[fixed-plugin]")) {
  loadJS(to_build + "assets/js/fixed-plugin.js");
}
if (document.querySelector("[navbar-main]")) {
  loadJS(to_build + "assets/js/sidenav-burger.js");
  loadJS(to_build + "assets/js/navbar-sticky.js");
}
if (document.querySelector("canvas")) {
  loadJS(to_build + "assets/js/chart-1.js");
  loadJS(to_build + "assets/js/chart-2.js");
}

// --------- Charts ---------
var ctx = document.getElementById("chart-bars")?.getContext("2d");
if (ctx) {
  new Chart(ctx, {
    type: "bar",
    data: {
      labels: ["Apr", "May", "Jun", "Jul", "Aug", "Sep", "Oct", "Nov", "Dec"],
      datasets: [
        {
          label: "Sales",
          tension: 0.4,
          borderWidth: 0,
          borderRadius: 4,
          borderSkipped: false,
          backgroundColor: "#fff",
          data: [450, 200, 100, 220, 500, 100, 400, 230, 500],
          maxBarThickness: 6,
        },
      ],
    },
    options: {
      responsive: true,
      maintainAspectRatio: false,
      plugins: { legend: { display: false } },
      interaction: { intersect: false, mode: "index" },
      scales: {
        y: {
          grid: { drawBorder: false, display: false, drawOnChartArea: false, drawTicks: false },
          ticks: {
            suggestedMin: 0,
            suggestedMax: 600,
            beginAtZero: true,
            padding: 15,
            font: { size: 14, family: "Open Sans", style: "normal", lineHeight: 2 },
            color: "#fff",
          },
        },
        x: {
          grid: { drawBorder: false, display: false, drawOnChartArea: false, drawTicks: false },
          ticks: { display: false },
        },
      },
    },
  });
}

var ctx2 = document.getElementById("chart-line")?.getContext("2d");
if (ctx2) {
  var gradientStroke1 = ctx2.createLinearGradient(0, 230, 0, 50);
  gradientStroke1.addColorStop(1, "rgba(203,12,159,0.2)");
  gradientStroke1.addColorStop(0.2, "rgba(72,72,176,0.0)");
  gradientStroke1.addColorStop(0, "rgba(203,12,159,0)");

  var gradientStroke2 = ctx2.createLinearGradient(0, 230, 0, 50);
  gradientStroke2.addColorStop(1, "rgba(20,23,39,0.2)");
  gradientStroke2.addColorStop(0.2, "rgba(72,72,176,0.0)");
  gradientStroke2.addColorStop(0, "rgba(20,23,39,0)");

  new Chart(ctx2, {
    type: "line",
    data: {
      labels: ["Apr", "May", "Jun", "Jul", "Aug", "Sep", "Oct", "Nov", "Dec"],
      datasets: [
        {
          label: "Mobile apps",
          tension: 0.4,
          borderWidth: 0,
          pointRadius: 0,
          borderColor: "#cb0c9f",
          borderWidth: 3,
          backgroundColor: gradientStroke1,
          fill: true,
          data: [50, 40, 300, 220, 500, 250, 400, 230, 500],
          maxBarThickness: 6,
        },
        {
          label: "Websites",
          tension: 0.4,
          borderWidth: 0,
          pointRadius: 0,
          borderColor: "#3A416F",
          borderWidth: 3,
          backgroundColor: gradientStroke2,
          fill: true,
          data: [30, 90, 40, 140, 290, 290, 340, 230, 400],
          maxBarThickness: 6,
        },
      ],
    },
    options: {
      responsive: true,
      maintainAspectRatio: false,
      plugins: { legend: { display: false } },
      interaction: { intersect: false, mode: "index" },
      scales: {
        y: {
          grid: { drawBorder: false, display: true, drawOnChartArea: true, drawTicks: false, borderDash: [5, 5] },
          ticks: { display: true, padding: 10, color: "#b2b9bf", font: { size: 11, family: "Open Sans" } },
        },
        x: {
          grid: { drawBorder: false, display: false, drawOnChartArea: false, drawTicks: false },
          ticks: { display: true, color: "#b2b9bf", padding: 20, font: { size: 11, family: "Open Sans" } },
        },
      },
    },
  });
}

// --------- Navbar notifications dropdown ---------
var dropdown_triggers = document.querySelectorAll("[dropdown-trigger]");
dropdown_triggers.forEach((dropdown_trigger) => {
  let dropdown_menu = dropdown_trigger.parentElement.querySelector("[dropdown-menu]");
  dropdown_trigger.addEventListener("click", function () {
    dropdown_menu.classList.toggle("opacity-0");
    dropdown_menu.classList.toggle("pointer-events-none");
    dropdown_menu.classList.toggle("before:-top-5");
    if (dropdown_trigger.getAttribute("aria-expanded") === "false") {
      dropdown_trigger.setAttribute("aria-expanded", "true");
      dropdown_menu.classList.remove("transform-dropdown");
      dropdown_menu.classList.add("transform-dropdown-show");
    } else {
      dropdown_trigger.setAttribute("aria-expanded", "false");
      dropdown_menu.classList.remove("transform-dropdown-show");
      dropdown_menu.classList.add("transform-dropdown");
    }
  });
  window.addEventListener("click", function (e) {
    if (!dropdown_menu.contains(e.target) && !dropdown_trigger.contains(e.target)) {
      if (dropdown_trigger.getAttribute("aria-expanded") === "true") {
        dropdown_trigger.click();
      }
    }
  });
});

// --------- Tabs navigation ---------
// (code identique à celui que tu avais, je peux te le laisser ou l’alléger si tu veux)

// --------- Sidenav burger ---------
var sidenav = document.querySelector("aside");
var sidenav_trigger = document.querySelector("[sidenav-trigger]");
var sidenav_close_button = document.querySelector("[sidenav-close]");
if (sidenav && sidenav_trigger && sidenav_close_button) {
  var burger = sidenav_trigger.firstElementChild;
  var top_bread = burger.firstElementChild;
  var bottom_bread = burger.lastElementChild;

  sidenav_trigger.addEventListener("click", function () {
    if (page === "virtual-reality") {
      sidenav.classList.toggle("xl:left-[18%]");
    }
    sidenav_close_button.classList.toggle("hidden");
    sidenav.classList.toggle("translate-x-0");
    sidenav.classList.toggle("shadow-soft-xl");
    if (page === "rtl") {
      top_bread.classList.toggle("-translate-x-[5px]");
      bottom_bread.classList.toggle("-translate-x-[5px]");
    } else {
      top_bread.classList.toggle("translate-x-[5px]");
      bottom_bread.classList.toggle("translate-x-[5px]");
    }
  });

  sidenav_close_button.addEventListener("click", function () {
    sidenav_trigger.click();
  });

  window.addEventListener("click", function (e) {
    if (!sidenav.contains(e.target) && !sidenav_trigger.contains(e.target)) {
      if (sidenav.classList.contains("translate-x-0")) {
        sidenav_trigger.click();
      }
    }
  });
}

// --------- Navbar sticky ---------
var navbar = document.querySelector("[navbar-main]");
window.onscroll = function () {
  let blur = navbar?.getAttribute("navbar-scroll");
  if (blur === "true") stickyNav();
};
function stickyNav() {
  if (window.scrollY >= 5) {
    navbar.classList.add("sticky", "top-[1%]", "backdrop-saturate-[200%]", "backdrop-blur-[30px]", "bg-[hsla(0,0%,100%,0.8)]", "shadow-blur", "z-110");
  } else {
    navbar.classList.remove("sticky", "top-[1%]", "backdrop-saturate-[200%]", "backdrop-blur-[30px]", "bg-[hsla(0,0%,100%,0.8)]", "shadow-blur", "z-110");
  }
}

// --------- Perfect Scrollbar (Windows only) ---------
(function () {
  var isWindows = navigator.platform.indexOf("Win") > -1;
  if (isWindows) {
    if (document.querySelector("main")) {
      new PerfectScrollbar(document.querySelector("main"));
    }
    document.querySelectorAll(".overflow-auto, .overflow-y-auto, .overflow-x-auto").forEach((el) => {
      new PerfectScrollbar(el);
    });
  }
})();
